<!DOCTYPE html>
<html>
<head>
<title>DPMB Commit Map</title>
<script src="ol/ol.js"></script>
<link rel="stylesheet" href="ol/ol.css" type="text/css">
</head>
<body>
<div id="map" class="map" ></div>
<div id="info" class="alert">
&nbsp;
</div>
<script>

<!-- based on sundial and kml examples from openlayers -->

var projection = ol.proj.get('EPSG:3857'); 
//  evtl andere projektion benutzen, fuer europa gehts erstmal 
//  projection: new OpenLayers.Projection("EPSG:900913"),
//  displayProjection: new OpenLayers.Projection("EPSG:4326")


var attribution = new ol.control.Attribution({
		  collapsible: false
});

var vector = new ol.layer.Vector({
     source: new ol.source.Vector({
     url: 'dpmb.kml',
	 format: new ol.format.KML({
	                     extractStyles: true, 
	                     extractAttributes: true,
	                 })
	 })
});

       
var osm = new ol.layer.Tile({
		source: new ol.source.OSM({showPointNames:false})
});

var map = new ol.Map({
		layers: [osm, vector],
		controls: ol.control.defaults({ attribution: false }).extend([attribution]),
		target: document.getElementById('map'),
		view: new ol.View({
				center: [1276970.8463461736, 6459807.853963373],
				projection: projection,
				zoom: 6
		})
});

var features = [];

var displayFeatureInfo = function(pixel) {
		features = [];
		map.forEachFeatureAtPixel(pixel, function(feature, layer) {features.push(feature);});
		if (features.length > 0) {
				url = features[0].get('name');
				document.getElementById('info').innerHTML = 'click to open: https://github.com/dpmb/dpmb/commit/' + url ;	  
		}
		else {document.getElementById('info').innerHTML = '';}
};

map.on('pointermove', function(evt) {
		if (evt.dragging) {return;}
		var pixel = map.getEventPixel(evt.originalEvent);
		displayFeatureInfo(pixel);
});

map.on('click', function(evt) {
		if (features.length > 0) {window.open('https://github.com/dpmb/dpmb/commit/' + url);}
});


map.on('singleclick', function(evt) {
	  	var features = [];
	  	map.forEachFeatureAtPixel(pixel, function(feature, layer) {features.push(feature);});
		var viewResolution = /** @type {number} */ (view.getResolution());
		var url = wmsSource.getGetFeatureInfoUrl(evt.coordinate, viewResolution, 'EPSG:3857',{'INFO_FORMAT': 'text/html' });
});

</script>
</body>
</html>
